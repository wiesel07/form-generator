/**
 * * Auto generated by Bossssoft Studio version 1.0 beta Fri Nov 18 17:20:59 CST
 * 2016
 */
// define(['引入外部js模块或控件'],function('引入外部js或控件的别名'){})
define(["app/app-pagebase","resources/egov/js/utils/print.js"],
	function(PageBase,PrintUtil){
		var ${main.capitalEntityName}Util= PageBase.extend({
			 ACTION: {
		            ADD: "ADD",
		            EDIT: "EDIT",
		            VIEW: "VIEW",
		            AUDIT: "AUDIT",
		            AUDIT_REJECT:"AUDIT_REJECT"
			 },
		
			BeforeCloseCallBack:null,
		
			printUseBill:function(row,self,mode){
				var _self =${main.capitalEntityName}Util.getInstance();
				var billId = row.billId;
				var useType = "";
				var useName = "";
				$A.assetMsg.warn("打印模版等待补充！");
				
				if("USE"== mode){
				     useType = row.useMode;
					 useName = row.useModeName;
				}else if("RECOVER"==mode){
					useType = row.recoverMode;
					 useName = row.recoverModeName;
				}
				
				var moduleId = _self.enablePrintTemplate(useType);
				if(moduleId == '') {
					$A.assetMsg.warn("暂无【" + useName + "】类型打印模版！");
					return;
				}
				PrintUtil.initPrint(self,moduleId,billId);
			},
			
		     //资产使用打印事件
			print:function(templateId, params,flag,mode){
				
				$A.assetMsg.warn("打印模版等待补充！");
		
				var dateUrl ="";
				if("USE"==mode){
					dataUrl = "egov/asset/aims/aimsusecommon/getUsePrintData.do?"+"billId=" + params;
					//dataUrl = "egov/asset/template/print/getPrintData.do?billId=" + params;
				}else if("RECOVER"==mode){
					dataUrl = "egov/asset/aims/aimsuse/aimsrecovercommon/getRecoverPrintData.do?"+"billId=" + params;
				}
				
				//bsReport.printByTemplateUrl(dataUrl,templateId,flag);
				PrintUtil.operate('printByTemplateUrl',dataUrl,templateId,flag);
			},
			
			
			enablePrintTemplate:function(useMode){
				var _self =AimsUseUtil.getInstance();
				if(useMode == _self.MODE.APPLY){//领用
					return "39";
				} else if (useMode ==_self.MODE.INVEST){//对外投资申请
					return "57";
				} else if(useMode == _self.MODE.RENT){//出租申请
					return "60";
				} else if(useMode == _self.MODE.LEND){//出借申请
					return "65";
				} else if(useMode == _self.MODE.REPAIRE){//资产维修
					return "62";
				}else if(useMode == _self.MODE.RECOVER_APPLY){//资产交回模板
					return "63";
				} else if (useMode == _self.MODE.RECOVER_INVEST){//对外投资收回
					return "58";
				} else if(useMode ==_self.MODE.RECOVER_RENT){//出租收回
					return "61";
				} else if(useMode == _self.MODE.RECOVER_LEND){//出借收回
					return "66";
				} else{
					return '';
				}
			},

			//设置表单底部信息项
		    setBillFootInfo:function(data){
		    	var _self =${main.capitalEntityName}Util.getInstance();
		    	var curBillStatus =data.curBillStatus||'';
			    var bizStatusName = data.bizStatusName||'';
				var orgName = data.orgName||'';
				var createDate = data.createDate||'';
				var curMaker = data.curMaker||'';
				var nextStep = data.nextStep||'';
				var confirmDate= data.confirmDate||'';
				
				if(data.curEditStatus==_self.ACTION.ADD){
					bizStatusName ='新增';
				}
				switch(curBillStatus){
					case 2://已终审
						 $A(".page-foot span").append('<div class="bill-foot-status" id="moneyTip">业务状态：<b id="selectProject" style="color:green;">' + 
									bizStatusName+'('+confirmDate+')'+'</b></div> <div  class="bill-foot-info"> 单位:'+orgName+'&nbsp; |&nbsp;创建人:'+curMaker+'&nbsp; |&nbsp;创建日期:'+createDate+'</div>')
						break;
					case 3://修改或审核
						 $A(".page-foot span").append('<div class="bill-foot-status" id="moneyTip"> 业务状态：<b   id="selectProject" style="color:green;">'+
								 bizStatusName+'</b>'+' 当前环节：<b style="color:green;" id="surplusMoney">'+nextStep+'</b></div> <div  class="bill-foot-info"> 单位:'+orgName+'&nbsp; |&nbsp;创建人:'+curMaker+'&nbsp; |&nbsp;创建日期:'+createDate+'</div>')
						break;
					case 1://新增	 
					case 4://暂存时候
						 $A(".page-foot span").append('<div class="bill-foot-status" id="moneyTip"> 业务状态：<b   id="selectProject" style="color:green;">'+
								 bizStatusName+'</b></div> <div  class="bill-foot-info"> 单位:'+orgName+'&nbsp; |&nbsp;创建人:'+curMaker+'&nbsp; |&nbsp;创建日期:'+createDate+'</div>')
						break;
				    default:$A.assetMsg.warn('单据底部信息初始化失败！');
				            break;
				}
		    },
			//获取表单标题
		    getPageTitle:function(curEditStatus){
		    	var _self =${main.capitalEntityName}Util.getInstance();
		      
		        var title ="${main.comments";
	        	if(_self.ACTION.ADD==curEditStatus){
				    return "新建"+title;
	        	}  
	        	if(_self.ACTION.EDIT==curEditStatus){
	        	   return "修改"+title;
	      	    }  
	        	if(_self.ACTION.VIEW==curEditStatus || _self.ACTION.AUDIT_REJECT==curEditStatus){
	        		 return "查看"+title;
	      	    }  
	        	if(_self.ACTION.AUDIT==curEditStatus){
	        		 return "审核"+title;
	      	     }  
			},
			//窗口关卡前所调用方法重置
			beforeCloseReset:function(curEditStatus,callBack){
				var _self =${main.capitalEntityName}Util.getInstance();
				callBack=callBack||function(){};
			    var  beforeOptions ={}
			    var  button,msg,beforeClose ;
			
			    if(_self.ACTION.ADD == curEditStatus || _self.ACTION.EDIT == curEditStatus){
			    	msg = "当前编辑未保存，是否保存？",
			    	button=[ { name: '是', 
			    		       callback: callBack },
				            {  name: '否',callback: function () { $A.dialog.closeCurrent(); } },
				            { name: '取消', focus: true,callback: function () { }}
				        ];
			    }
			   	
			    if(_self.ACTION.AUDIT ==curEditStatus){
			    	msg ="是否退出？";
					button=[ {name: '是', callback: function () {$A.dialog.closeCurrent(); }},
				            { name: '否', focus: true,callback: function () { }}
				       ];
			    }
			
			    if(!(_self.ACTION.VIEW == curEditStatus || _self.ACTION.AUDIT_REJECT == curEditStatus)){
			    	 beforeOptions={msg:msg,button:button };
			    	    var $dlg = $A.dialog.getCurrent();
			        	var dlgObj = $dlg.data("options");
			        	dlgObj.beforeClose=$.closeCustom(beforeOptions);
			    }
			},
			//设置表单样式，主要用于设置表单不可编辑
			setFormFieldStyle:function($input){
			    	var len = $input.length;
		   		    for (var i=0;i<len;i++){
			   			 var options = $($input[i]).attr('_options');
						 if(options){
							 var obj = eval('(' + options + ')');
							 obj['readonly']='true';
							 var s = JSON.stringify(obj);
							 $($input[i]).attr('_options',s).addClass('form-field-view');
						 }else{
							 $($input[i]).attr('_options','{readonly:true}').addClass('form-field-view');
						 }
		   		    }		 
			},
			 
			initPage:function(){
				
			   },
			
		});
		

		${main.capitalEntityName}Util.getInstance=function(){
		     if (!this.instance){
		    	 this.instance =new ${main.capitalEntityName}Util();
		     }
		     return this.instance;
		 }
		return  ${main.capitalEntityName}Util.getInstance();
	   })
	   
	   
	   
	   
